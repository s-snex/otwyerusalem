<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>OTW YERUSALEM</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Courier+New&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* 
          THEME: Soft Lavender & Deep Charcoal 
          Versi Desktop-Only, dengan perbaikan tampilan & tab horizontal
          =====================================
          Diperbarui agar ukuran font seragam
        */
        :root {
            --background-color: #1F1E25;       
            --text-color: #ECE9F4;             
            --accent-color: #C8BFE7;           
            
            --button-color: #312F39;           
            --button-hover-color: #4C4859;     
            --input-background: #2D2A35; 
            --input-border: #C8BFE7;           

            --container-background: rgba(45, 42, 53, 0.6); 
            --box-shadow: 0 4px 12px rgba(0,0,0,0.4);
            --border-radius: 6px;
            --transition-speed: 0.3s;
            
            /* Font-size diselaraskan */
            --font-size-heading: 1.2em;  /* H2/h3 sedikit lebih besar */
            --font-size-normal: 1em;     /* Untuk teks, input, label, dll */
            --font-size-small: 0.9em;    /* Label atau info yang lebih kecil */

            /* Layouting */
            --sidebar-width: 50px; 
            --sidebar-icon-size: 18px;
            --sidebar-padding: 10px 0;
            --sidebar-link-color: #ECE9F4;
            --sidebar-link-hover-bg: #C8BFE7;
            --sidebar-link-hover-color: #1F1E25;
        }

        * {
            box-sizing: border-box;
        }
        html, body {
            margin: 0;
            padding: 0;
            font-family: 'Courier New', monospace;
            height: 100%;
            width: 100%;
            background-color: var(--background-color);
            color: var(--text-color);
            font-size: var(--font-size-normal); /* Standar font-size */
        }
        body {
            background-image: url('https://i.giphy.com/media/v1.Y2lkPTc5MGI3NjExbzI5NnR4ZTdwYjUwNnllbmprc3RtbjR0MDduYWJuNXJ6NXRheml6MCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9dg/HNNxPpLSQlRMoqsLyO/giphy.gif');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        /* Sidebar */
        .sidebar {
            float: left;
            width: var(--sidebar-width);
            background-color: rgba(31, 30, 37, 0.3);
            box-shadow: 2px 0 5px rgba(0,0,0,0.6);
            padding: var(--sidebar-padding);
            height: 100vh; 
            overflow-y: auto;
            position: relative;
        }
        .sidebar h2 {
            display: none;
        }
        .sidebar a {
            display: block;
            text-decoration: none;
            text-align: center;
            font-size: var(--sidebar-icon-size);
            color: var(--sidebar-link-color);
            padding: 8px 0;
            margin-bottom: 6px;
            border-radius: 4px;
            transition: background-color var(--transition-speed), color var(--transition-speed);
        }
        .sidebar a:hover {
            background-color: var(--sidebar-link-hover-bg);
            color: var(--sidebar-link-hover-color);
        }
        .sidebar a .tooltip {
            visibility: hidden;
            position: absolute;
            left: 55px;
            background-color: var(--text-color);
            color: var(--background-color);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: var(--font-size-small);
            top: 50%;
            transform: translateY(-50%);
            white-space: nowrap;
            z-index: 99;
        }
        .sidebar a:hover .tooltip {
            visibility: visible;
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            background-color: rgba(31, 30, 37, 0.5);
            min-height: 100vh; 
            width: calc(100% - var(--sidebar-width));
            padding: 15px;
            box-sizing: border-box;
        }

        .page-container {
            display: none;
            width: 100%;
        }
        .page-container.visible {
            display: block;
        }

        /* Group Container -> inline-block agar 2 kontainer berdampingan di Page 1 */
        .group-container {
            display: inline-block;
            vertical-align: top;
            width: 48%; /* agar 2 kolom muat di Page 1 */
            margin: 0.5%;
            background-color: var(--container-background);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden; 
        }

        /* 
           KHUSUS untuk Page 2 dan Page 3 
           -> kontainer lebih kecil & center 
        */
		
        #page2 .group-container,
        #page3 .group-container {
            display: block;       /* override agar tidak inline-block */
            width: 48%;           /* lebih kecil */
            max-width: 600px;     /* batasi lebar maksimal */
            margin: 20px auto;    /* center di tengah-tengah */
        }

        /* Tabs style: horizontal */
        .tabs {
            display: flex; 
            align-items: center; 
            background-color: var(--button-color);
            padding: 0 8px;
            border-bottom: 1px solid var(--input-border);
        }
        .tabs button {
            background-color: transparent;
            border: none;
            outline: none;
            cursor: pointer;
            font-size: var(--font-size-normal);
            color: var(--text-color);
            padding: 10px 16px;
            margin-right: 4px;
            transition: background-color var(--transition-speed), color var(--transition-speed);
            border-radius: 4px 4px 0 0;
        }
        .tabs button.active {
            background-color: var(--input-background);
            font-weight: bold;
            border-bottom: 3px solid var(--accent-color);
        }

        .tabcontent {
            display: none;
            padding: 10px;
        }
        .tabcontent.active {
            display: block;
        }

        /* Heading, label, dsb */
        h2 {
            color: var(--accent-color);
            text-shadow: 0 0 2px var(--accent-color);
            text-align: center;
            font-size: var(--font-size-heading);
            margin: 8px 0;
        }
        h3 {
            color: var(--accent-color);
            text-align: center;
            font-size: var(--font-size-normal);
            margin: 6px 0;
        }
        .box-label {
            font-weight: bold;
            font-size: var(--font-size-small);
            margin-top: 6px;
            margin-bottom: 3px;
        }
        .info-label {
            font-size: var(--font-size-small);
            margin-bottom: 5px;
        }

        /* Form, input, button, textarea */
        textarea, button, input {
            width: 100%;
            padding: 8px;
            margin: 4px 0;
            border-radius: 4px;
            border: 1px solid var(--input-border);
            background-color: var(--input-background);
            color: var(--text-color);
            font-size: var(--font-size-normal);
            font-family: 'Courier New', monospace;
            transition: border-color var(--transition-speed), box-shadow var(--transition-speed);
        }
        textarea:focus, input:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 5px var(--accent-color);
            outline: none;
        }
        button {
            background-color: var(--button-color);
            border: 1px solid var(--input-border);
            cursor: pointer;
            transition: background-color var(--transition-speed),
                        transform var(--transition-speed), 
                        box-shadow var(--transition-speed);
        }
        button:hover {
            background-color: var(--button-hover-color);
            box-shadow: 0 0 8px var(--input-border);
            transform: scale(1.03);
        }

        /* .result-box dsb */
        .result-box {
            background-color: var(--input-background);
            color: var(--text-color);
            min-height: 80px;
            margin: 6px 0;
            padding: 8px;
            border: 1px solid var(--input-border);
            border-radius: 4px;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: var(--font-size-normal);
            box-shadow: inset 0 0 4px var(--input-border);
        }
        .result-box-container {
            margin-bottom: 8px;
        }
        .hasil-item {
            margin-bottom: 8px;
        }
        .hasil-label {
            font-weight: bold; 
            font-size: var(--font-size-small);
            margin-bottom: 2px;
        }

        /* Priority inputs */
        .priority-inputs {
            display: flex; 
            flex-wrap: wrap; 
            gap: 4px;
        }
        .priority-inputs input {
            width: 270px; 
        }

        /* Tabel */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 6px;
        }
        th, td {
            border: 1px solid var(--input-border);
            padding: 6px;
            text-align: left;
            font-size: var(--font-size-small);
        }
        th {
            background-color: var(--button-color);
            color: var(--text-color);
            font-size: var(--font-size-small);
        }
    </style>
</head>
<body>

  <!-- Sidebar Navigasi -->
  <div class="sidebar">
    <a href="#" onclick="showPage('page1')">
      <i class="fas fa-utensils"></i>
      <span class="tooltip">Lets Cook</span>
    </a>
    <a href="#" onclick="showPage('page2')">
      <i class="fas fa-search"></i>
      <span class="tooltip">Screening</span>
    </a>
    <a href="#" onclick="showPage('page3')">
      <i class="fas fa-flask"></i>
      <span class="tooltip">Riset</span>
    </a>
  </div>

  <!-- Main Content -->
  <div class="main-content">

    <!-- ===================== PAGE 1 ===================== -->
    <div id="page1" class="page-container visible">
      <!-- Kontainer 1: Poltar & MagicByTrbb -->
      <div class="group-container">
        <div class="tabs">
          <button class="tablinks active" onclick="openTab(event, 'PoltarByTrbb')">PoltarByTrbb</button>
          <button class="tablinks" onclick="openTab(event, 'MagicByTrbb')">MagicByTrbb</button>
        </div>

        <!-- Tab PoltarByTrbb -->
        <div id="PoltarByTrbb" class="tabcontent active">
            <input type="text" id="inputBox1" placeholder="Masukkan 4 angka" maxlength="4" oninput="updateTotalPoltar()">
            <textarea id="outputBox3" class="result-box" readonly></textarea>
            <div class="info-label" id="totalResultPoltar">Total Kombinasi: 0</div>
            <button onclick="generatePoltar()">Generate</button>
            <button onclick="hapusGanjilGenapPoltarBytrbb()" style="text-decoration: line-through;">
              Odd/Even
            </button>
            <button onclick="hapusSimetrisDanTigaAngka()">Let Him Cook</button>
            <button onclick="copyToClipboard()">Copy</button>
        </div>

        <!-- Tab MagicByTrbb -->
        <div id="MagicByTrbb" class="tabcontent">
            <input type="text" id="numbersSigar" placeholder="Masukkan angka dipisahkan *" oninput="updateTotalSigar()">
            <div id="totalStringSigar" class="info-label">Total Angka: 0</div>

            <button onclick="splitAndShuffleNumbers()">Pisah dan Acak</button>
            
            <!-- Tombol hapus (sementara disilang) -->
            <button onclick="hapusGanjilGenapPoltar()" style="text-decoration: line-through;">
              Odd/Even
            </button>
            <button onclick="hapusTigaAngkaBerurutanPoltar()" style="text-decoration: line-through;">
              Tiga Angka Berurutan
            </button>
            <button onclick="hapusSimetrisCombinePoltar()" style="text-decoration: line-through;">
              Simetris
            </button>

            <div id="total-string" class="info-label">Total Angka: 0</div>
            <div id="result-container"></div>
        </div>
      </div>
      <!-- /group-container (Poltar & Magic) -->

      <!-- Kontainer 2: Sigar & PembalikByTrbb -->
      <div class="group-container">
        <div class="tabs">
          <button class="tablinks active" onclick="openTab(event, 'SigarByTrbb')">SigarByTrbb</button>
          <button class="tablinks" onclick="openTab(event, 'PembalikByTrbb')">PembalikByTrbb</button>
        </div>

        <!-- Tab SigarByTrbb -->
        <div id="SigarByTrbb" class="tabcontent active">
            <input type="text" id="inputAngkaMagic" placeholder="Masukkan deret angka (pisahkan dengan *)" oninput="updateTotalMagic()">
            <div id="totalAngkaMagic" class="info-label">Total Angka: 0</div>
            <input type="number" id="jumlahBagianMagic" placeholder="Jumlah bagian" min="1" max="10" value="6" oninput="generatePriorityInputsMagic()">
            
            <div id="priorityInputsMagic" class="priority-inputs"></div>

            <button onclick="bagiDanPrioritasAngka()">Bagi dan Prioritas Angka</button>
            <div id="hasilContainerMagic"></div>
        </div>

        <!-- Tab PembalikByTrbb -->
        <div id="PembalikByTrbb" class="tabcontent">
            <input type="text" id="filterNumbersPembalik" placeholder="Masukkan angka yang ingin difilter (pisahkan *)" 
                   oninput="updateTotalPembalik()">
            <div id="totalAngkaPembalik" class="info-label">Total Angka: 0</div>
            <button onclick="filterNumbers()">Generate</button>
            <textarea id="filterResult" class="result-box" readonly></textarea>
            <div class="info-label" id="filterTotal">Total Angka: 0</div>
            <button onclick="copyFilterResult()">Copy</button>
        </div>
      </div>
      <!-- /group-container (Sigar & Pembalik) -->
    </div>
    <!-- /page1 -->

    <!-- ===================== PAGE 2 ===================== -->
    <div id="page2" class="page-container">
      <!-- Kontainer 1: Data Market -->
      <div class="group-container">
        <iframe id="widgetIframe"
          src="https://widgets.vegasnet.info/result.php?show_id=2,4,5,8,9,10,12,13,15,16,17,18,22,24,26,29,30,31,36,37,38,39,40,42,43,44,45,47,49,50,51,53,54,56,57,59,60,61,65,67,70,72,74,76,77,84,88,89,90,91,93,94,98,99,101,113,114,115,116,157,160,166,167,168,169,170,171&bgcolor=444444&bgcolor2=555555&fontcolor=CCCCCC"
          width="100%"
          height="200"
          style="border:none; border-radius:4px;"
        ></iframe>
      </div>

      <!-- Kontainer 2: Input Data & Hasil -->
      <div class="group-container">
        <h2>Input Data</h2>
        <!-- Textarea data input -->
        <textarea id="dataInput2" rows="5" cols="40" placeholder="Masukkan data di sini..."></textarea>
        <br>
        <!-- Tombol untuk proses parsing & pencarian -->
        <button onclick="parseAndSearch2()">Cari Data</button>

        <hr>
        <h2>Hasil:</h2>
        <div id="result2" class="result-box" style="height:auto;"></div>
      </div>
    </div>
    <!-- /page2 -->

    <!-- ===================== PAGE 3 ===================== -->
    <div id="page3" class="page-container">
      <div class="group-container">
        <div class="tabs">
          <button class="tablinks active" onclick="openTab(event, 'CombineByTrbb')">CombineByTrbb</button>
          <button class="tablinks" onclick="openTab(event, 'SubtraByTrbb')">SubtraByTrbb</button>
        </div>

        <!-- Tab CombineByTrbb -->
        <div id="CombineByTrbb" class="tabcontent active">
          <div class="box-label">Data A</div>
          <textarea 
            id="risetInput1" 
            placeholder="Masukkan string 4 digit angka dipisahkan *"
            oninput="updateRisetCount('risetInput1','risetTotal1')"
          ></textarea>
          <div id="risetTotal1" class="info-label">Total String: 0</div>

          <div class="box-label">Data B</div>
          <textarea 
            id="risetInput2" 
            placeholder="Masukkan string 4 digit angka dipisahkan *"
            oninput="updateRisetCount('risetInput2','risetTotal2')"
          ></textarea>
          <div id="risetTotal2" class="info-label">Total String: 0</div>

          <div class="box-label">Data C</div>
          <textarea 
            id="risetInput3" 
            placeholder="Masukkan string 4 digit angka dipisahkan *"
            oninput="updateRisetCount('risetInput3','risetTotal3')"
          ></textarea>
          <div id="risetTotal3" class="info-label">Total String: 0</div>

          <div class="box-label">Data D</div>
          <textarea 
            id="risetInput4" 
            placeholder="Masukkan string 4 digit angka dipisahkan *"
            oninput="updateRisetCount('risetInput4','risetTotal4')"
          ></textarea>
          <div id="risetTotal4" class="info-label">Total String: 0</div>

          <button onclick="combineRisetData()">Combine Data</button>

          <h3>Result</h3>
          <textarea id="risetCombinedResult" class="result-box" readonly></textarea>
          <div class="info-label" id="risetCombinedCount">Total Gabungan: 0</div>
          <button onclick="copyRisetResult()">Copy</button>
        </div>
        <!-- /CombineByTrbb -->

        <!-- Tab SubtraByTrbb -->
        <div id="SubtraByTrbb" class="tabcontent">
          <div class="box-label">Data A</div>
          <textarea 
              id="penguranganInputA" 
              placeholder="Masukkan angka A (pisahkan dengan *)"
              oninput="updatePenguranganTotal('penguranganInputA', 'penguranganTotalA')"
          ></textarea>
          <div id="penguranganTotalA" class="info-label">Total String: 0</div>
          
          <div class="box-label">Data B</div>
          <textarea 
              id="penguranganInputB" 
              placeholder="Masukkan angka B (pisahkan dengan *)"
              oninput="updatePenguranganTotal('penguranganInputB', 'penguranganTotalB')"
          ></textarea>
          <div id="penguranganTotalB" class="info-label">Total String: 0</div>
          
          <button onclick="kurangiAngka()">Subtraction</button>
          
          <h3>Result</h3>
          <textarea id="penguranganResult" class="result-box" readonly></textarea>
          <div class="info-label" id="penguranganCount">Total String: 0</div>
          <button onclick="copyPenguranganResult()">Copy</button>
        </div>
        <!-- /SubtraByTrbb -->
      </div>
    </div>
    <!-- /page3 -->

  </div>
  <!-- /main-content -->

  <script>
    /* ===================== NAVIGASI PAGE ===================== */
    function showPage(pageId){
        const pages = document.querySelectorAll('.page-container');
        pages.forEach(page => {
            page.classList.remove('visible');
            page.style.display = 'none';
        });
        const target = document.getElementById(pageId);
        target.classList.add('visible');
        target.style.display = 'block';
    }

    /* ===================== TAB FUNCTION ===================== */
    function openTab(evt, tabName) {
      const parentContainer = evt.currentTarget.closest('.group-container');
      const tabcontents = parentContainer.querySelectorAll('.tabcontent');
      const tablinks = parentContainer.querySelectorAll('.tablinks');

      // Hide all tabcontent
      tabcontents.forEach(content => {
          content.classList.remove('active');
      });

      // Remove active class from all tabs
      tablinks.forEach(tab => {
          tab.classList.remove('active');
      });

      // Show current tab
      const currentTab = parentContainer.querySelector(`#${tabName}`);
      currentTab.classList.add('active');
      evt.currentTarget.classList.add('active');
    }

    /* ===================== POLTARBYTRBB ===================== */
    function updateTotalPoltar() { 
      // ...
    }
    function generatePoltar() {
      const input = document.getElementById('inputBox1').value;
      if (input.length === 4 && /^\d{4}$/.test(input)) {
          const baseString = "1234567890";
          let a = baseString.replace(new RegExp(input[0], 'g'), '');
          let b = baseString.replace(new RegExp(input[1], 'g'), '');
          let c = baseString.replace(new RegExp(input[2], 'g'), '');
          let d = baseString.replace(new RegExp(input[3], 'g'), '');
          const aDigits = a.split('');
          const bDigits = b.split('');
          const cDigits = c.split('');
          const dDigits = d.split('');

          let results = [];
          aDigits.forEach(num1 => {
              bDigits.forEach(num2 => {
                  cDigits.forEach(num3 => {
                      dDigits.forEach(num4 => {
                          results.push(num1 + num2 + num3 + num4);
                      });
                  });
              });
          });

          // Shuffle agar acak
          results = shuffleArray(results);

          document.getElementById('outputBox3').textContent = results.join('*');
          document.getElementById('totalResultPoltar').textContent = 
            `Total Kombinasi: ${results.length}`;
      } else {
          alert("Masukkan 4 digit angka yang valid!");
      }
    }
    function hapusSimetrisDanTigaAngka() {
      const angkaArray = document.getElementById('outputBox3').textContent.split('*');
      const hasil = angkaArray.filter(num => {
          if(num.length !== 4) return false;

          const pasanganSimetris = (num[0] === num[1] && num[2] === num[3]);
          const palindromik      = (num[0] === num[3] && num[1] === num[2]);
          const ascending        = '123456789';
          const descending       = '987654321';
          const berkesinambungan = (
              num.slice(0,2) === num.slice(2,4) || 
              (num[0] === num[2] && num[1] === num[3])
          );
          // Cek triple digit
          for (let i = 0; i < num.length - 2; i++) {
              if (num[i] === num[i+1] && num[i] === num[i+2]) {
                  return false;
              }
          }
          const angkaBerurutan = ascending.includes(num) || descending.includes(num);
          return !(
             pasanganSimetris || palindromik || angkaBerurutan || berkesinambungan
          );
      });
      const shuffledHasil = shuffleArray(hasil);
      document.getElementById('outputBox3').textContent = shuffledHasil.join('*');
      document.getElementById('totalResultPoltar').textContent = 
        `Total Kombinasi: ${shuffledHasil.length}`;
    }
    function hapusGanjilGenapPoltarBytrbb(){
      const outputBox = document.getElementById('outputBox3');
      let splitted = outputBox.textContent.split('*');
      let filtered = splitted.filter(num => {
          if (num.length !== 4) return false;
          let allOdd = true;
          let allEven = true;
          for (let digit of num) {
              let d = parseInt(digit, 10);
              if (d % 2 === 0) {
                  allOdd = false;
              } else {
                  allEven = false;
              }
          }
          return !(allOdd || allEven);
      });
      const shuffledFiltered = shuffleArray(filtered);
      outputBox.textContent = shuffledFiltered.join('*');
      document.getElementById('totalResultPoltar').textContent = 
        `Total Kombinasi: ${shuffledFiltered.length}`;
    }
    function copyToClipboard(element) {
      if (!element) {
          element = document.getElementById('outputBox3');
      }
      navigator.clipboard.writeText(element.value || element.textContent).then(() => {
          alert('Hasil telah disalin ke clipboard!');
      }).catch(() => {
          alert('Gagal menyalin ke clipboard.');
      });
    }

    /* ===================== MAGICBYTRBB (Pisah & Acak) ===================== */
    function updateTotalSigar() {
      const input = document.getElementById('numbersSigar').value.trim();
      const total = (input === '') 
                    ? 0 
                    : input.split('*').filter(num => num.trim() !== '').length;
      document.getElementById('totalStringSigar').textContent = `Total Angka: ${total}`;
    }
    function splitAndShuffleNumbers() {
      const numbers = document
          .getElementById('numbersSigar')
          .value
          .trim()
          .split('*')
          .filter(num => num.trim() !== '');
      const parts = 1; 
      const shuffledNumbers = shuffleArray(numbers);
      document.getElementById('total-string').textContent = 
        `Total String: ${shuffledNumbers.length}`;

      const chunked = chunkArray(shuffledNumbers, parts);
      const resultContainer = document.getElementById('result-container');
      resultContainer.innerHTML = '';

      chunked.forEach((chunk, index) => {
          const resultBox = document.createElement('div');
          resultBox.classList.add('result-box-container');

          const textArea = document.createElement('textarea');
          textArea.classList.add('result-box');
          textArea.value = chunk.join('*');
          textArea.setAttribute('readonly', true);

          const copyButton = document.createElement('button');
          copyButton.textContent = `Copy ${index + 1}`;
          copyButton.onclick = function() {
              copyToClipboard(textArea);
          };

          resultBox.appendChild(textArea);
          resultBox.appendChild(copyButton);
          resultContainer.appendChild(resultBox);
      });
    }
    function hapusGanjilGenapPoltar(){
      const resultContainer = document.getElementById('result-container');
      const textAreas = resultContainer.querySelectorAll('textarea.result-box');
      let overallCount = 0; 
      textAreas.forEach(ta => {
          const splitted = ta.value.split('*');
          const filtered = splitted.filter(num => {
              if (num.length !== 4) return false;
              let allOdd = true;
              let allEven = true;
              for (let digit of num) {
                  const d = parseInt(digit, 10);
                  if (d % 2 === 0) {
                      allOdd = false;
                  } else {
                      allEven = false;
                  }
              }
              return !(allOdd || allEven);
          });
          const shuffledFiltered = shuffleArray(filtered);
          ta.value = shuffledFiltered.join('*');
          overallCount += shuffledFiltered.length;
      });
      document.getElementById('total-string').textContent = 
        `Total String: ${overallCount}`;
    }
    function hapusTigaAngkaBerurutanPoltar(){
      filterSigarTextAreas(num => {
        for (let i = 0; i < num.length - 2; i++) {
            if (num[i] === num[i+1] && num[i] === num[i+2]) {
                return false; 
            }
        }
        return true;
      });
      const textAreas = document.querySelectorAll('#result-container textarea.result-box');
      textAreas.forEach(ta => {
          const splitted = ta.value.split('*');
          const shuffled = shuffleArray(splitted);
          ta.value = shuffled.join('*');
      });
    }
    function hapusSimetrisCombinePoltar(){
      filterSigarTextAreas(num => {
        const pasanganSimetris = (num[0] === num[1] && num[2] === num[3]);
        const palindromik      = (num[0] === num[3] && num[1] === num[2]);
        const ascending  = '123456789';
        const descending = '987654321';
        const ascdesc    = ascending.includes(num) || descending.includes(num);
        const berkesinambungan = (
            num.slice(0,2) === num.slice(2,4) ||
            (num[0] === num[2] && num[1] === num[3])
        );
        return !(pasanganSimetris || palindromik || ascdesc || berkesinambungan);
      });
      const textAreas = document.querySelectorAll('#result-container textarea.result-box');
      textAreas.forEach(ta => {
          const splitted = ta.value.split('*');
          const shuffled = shuffleArray(splitted);
          ta.value = shuffled.join('*');
      });
    }
    function filterSigarTextAreas(predicate){
      const resultContainer = document.getElementById('result-container');
      const textAreas = resultContainer.querySelectorAll('textarea.result-box');
      let overallCount = 0;
      textAreas.forEach(ta => {
          const splitted = ta.value.split('*');
          const filtered = splitted.filter(num => {
              if(num.length !== 4) return false;
              return predicate(num);
          });
          const shuffledFiltered = shuffleArray(filtered);
          ta.value = shuffledFiltered.join('*');
          overallCount += shuffledFiltered.length;
      });
      document.getElementById('total-string').textContent = 
        `Total String: ${overallCount}`;
    }

    /* ===================== SIGARBYTRBB (Bagi & Prioritas) ===================== */
    function updateTotalMagic() {
      const input = document.getElementById('inputAngkaMagic').value.trim();
      const total = (input === '') 
                    ? 0 
                    : input.split('*').filter(num => num.trim() !== '').length;
      document.getElementById('totalAngkaMagic').textContent = `Total Angka: ${total}`;
    }
    function generatePriorityInputsMagic(){
      const jumlah = parseInt(document.getElementById('jumlahBagianMagic').value);
      const container = document.getElementById('priorityInputsMagic');
      container.innerHTML = '';
      for(let i=1; i<=jumlah; i++){
          const input = document.createElement('input');
          input.type = 'number';
          input.id = 'prioritasAngkaMagic' + i;
          input.placeholder = 'Prio ' + i;
          input.min = 0; 
          container.appendChild(input);
      }
    }
    function bagiDanPrioritasAngka() {
      const inputString  = document.getElementById("inputAngkaMagic").value;
      let angkaArray     = inputString.split('*').filter(num => num.trim() !== '');
      const jumlahBagian = parseInt(document.getElementById("jumlahBagianMagic").value);
      const prioritasAngka = [];
      let totalPrioritas = 0;
      for (let i = 1; i <= jumlahBagian; i++) {
          let prio = parseInt(document.getElementById("prioritasAngkaMagic" + i).value) || 0;
          prioritasAngka.push(prio);
          totalPrioritas += prio;
      }
      if (totalPrioritas > angkaArray.length) {
          alert("Total prioritas melebihi jumlah angka!");
          return; 
      }
      // Acak seluruh array
      angkaArray = shuffleArray(angkaArray);
      let hasilBagi = [];
      // Alokasi sesuai prioritas
      prioritasAngka.forEach((prioritas, index) => {
          if (prioritas > 0) {
              hasilBagi[index] = angkaArray.splice(0, prioritas);
          } else {
              hasilBagi[index] = [];
          }
      });
      // Bagi sisa
      const sisaAngka = angkaArray.length;
      const kelompokTanpaPrioritas = hasilBagi.filter(grup => grup.length === 0).length;
      const sisaPerKelompok = (kelompokTanpaPrioritas > 0) 
                              ? Math.floor(sisaAngka / kelompokTanpaPrioritas) 
                              : 0;
      hasilBagi.forEach(grup => {
          if (grup.length === 0) {
              while (grup.length < sisaPerKelompok && angkaArray.length > 0) {
                  let randomIndex = Math.floor(Math.random() * angkaArray.length);
                  grup.push(angkaArray.splice(randomIndex, 1)[0]);
              }
          }
      });
      while (angkaArray.length > 0) {
          hasilBagi.forEach(grup => {
              if (angkaArray.length > 0) {
                  let randomIndex = Math.floor(Math.random() * angkaArray.length);
                  grup.push(angkaArray.splice(randomIndex, 1)[0]);
              }
          });
      }
      // Shuffle hasilBagi
      hasilBagi = shuffleArray(hasilBagi);
      // Shuffle setiap grup
      hasilBagi = hasilBagi.map(grup => shuffleArray(grup));
      // Tampilkan hasil
      const container = document.getElementById("hasilContainerMagic");
      container.innerHTML = '';
      hasilBagi.forEach((grup, index) => {
          const hasilItem = document.createElement("div");
          hasilItem.className = 'hasil-item';
          const label = document.createElement("div");
          label.className = 'hasil-label';
          label.textContent = `Hasil ${index + 1} (Jumlah Angka: ${grup.length}):`;
          const textarea = document.createElement("textarea");
          textarea.classList.add('result-box');
          textarea.setAttribute('readonly', true);
          textarea.value = grup.join('*');
          const copyButton = document.createElement("button");
          copyButton.textContent = `Copy Hasil ${index+1}`;
          copyButton.onclick = function() {
              copyToClipboard(textarea);
          };
          hasilItem.appendChild(label);
          hasilItem.appendChild(textarea);
          hasilItem.appendChild(copyButton);
          container.appendChild(hasilItem);
      });
    }

    /* ===================== PEMBALIKBYTRBB ===================== */
    function updateTotalPembalik() {
      const input = document.getElementById('filterNumbersPembalik').value.trim();
      const total = (input === '') 
                    ? 0 
                    : input.split('*').filter(num => num.trim() !== '').length;
      document.getElementById('totalAngkaPembalik').textContent = `Total Angka: ${total}`;
    }
    function filterNumbers() {
      const allNumbers = [];
      for(let i = 0; i < 10000; i++){
          const padded = String(i).padStart(4,'0');
          allNumbers.push(padded);
      }
      const userInput = document.getElementById('filterNumbersPembalik').value.trim();
      if(!userInput){
          return;
      }
      const excludeList = userInput.split('*');
      const filteredResult = allNumbers.filter(num => !excludeList.includes(num));
      const shuffledFilteredResult = shuffleArray(filteredResult);
      document.getElementById('filterResult').value = shuffledFilteredResult.join('*');
      document.getElementById('filterTotal').textContent = 
        `Total Angka: ${shuffledFilteredResult.length}`;
    }
    function copyFilterResult(){
      const filterResult = document.getElementById('filterResult');
      navigator.clipboard.writeText(filterResult.value || filterResult.textContent)
        .then(()=>{
            alert('Hasil filter telah disalin ke clipboard!');
      }).catch(()=>{
          alert('Gagal menyalin ke clipboard.');
      });
    }

    /* ===================== UTILITAS UMUM ===================== */
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }
    function chunkArray(array, size) {
      const result = [];
      const chunkSize = Math.floor(array.length / size);
      let remainder = array.length % size;
      for (let i = 0; i < size; i++){
          const start = i * chunkSize;
          const end   = start + chunkSize + (remainder > 0 ? 1 : 0);
          result.push(array.slice(start, end));
          remainder--;
      }
      return result;
    }

    /* ===================== PAGE 2 (Pencarian + Sort) ===================== */
    const timeLookup = {
      "Macau 00": "00:00",
      "Macau 13:00": "13:00",
      /* ... tambahkan jika perlu ... */
    };
    const fixedCodeString = `
4628*6277*6802*...*9999
`.trim();
    const fixedCodes = fixedCodeString.split("*");

    function parseAndSearch2() {
        const pattern = /^(.*?)\s+(\d{2}-\d{2}-\d{4})\s+(\d{4})$/;
        const lines = document.getElementById("dataInput2").value.trim().split("\n");
        const results = [];

        for (const line of lines) {
            const trimmedLine = line.trim();
            const match = trimmedLine.match(pattern);
            if (match) {
                const nameInfo  = match[1].trim();  
                const dateInfo  = match[2].trim();  
                const codeInfo  = match[3].trim();  
                const jamInfo = timeLookup[nameInfo] || "??:??";

                // Cek apakah codeInfo ada di fixedCodes
                if (fixedCodes.includes(codeInfo)) {
                    results.push(`${nameInfo}\t${dateInfo}\t${jamInfo}\t${codeInfo}`);
                }
            }
        }

        // Sorting by date (year, month, day), then jam
        let splittedResults = results.map(line => line.split('\t')); 
        splittedResults.sort((a, b) => {
           const [dayA, monA, yearA] = a[1].split('-').map(x => parseInt(x, 10));
           const [dayB, monB, yearB] = b[1].split('-').map(x => parseInt(x, 10));

           if (yearA !== yearB) return yearA - yearB;
           if (monA !== monB) return monA - monB;
           if (dayA !== dayB) return dayA - dayB;

           function parseJam(jam) {
             if (jam === "??:??") return 9999;
             const [H, M] = jam.split(':').map(n => parseInt(n, 10));
             return H * 60 + M;
           }
           return parseJam(a[2]) - parseJam(b[2]);
        });

        const sortedResults = splittedResults.map(arr => arr.join('\t'));

        const resultDiv = document.getElementById("result2");
        if (sortedResults.length > 0) {
            const tableRows = sortedResults.map(line => {
                const [nameInfo, dateInfo, jamInfo, codeInfo] = line.split('\t');
                return `
                  <tr>
                    <td>${nameInfo}</td>
                    <td>${dateInfo}</td>
                    <td>${jamInfo}</td>
                    <td>${codeInfo}</td>
                  </tr>
                `;
            }).join('');
            const tableHTML = `
              <table>
                <thead>
                  <tr>
                    <th>Keterangan</th>
                    <th>Tanggal</th>
                    <th>Jam</th>
                    <th>Kode</th>
                  </tr>
                </thead>
                <tbody>
                  ${tableRows}
                </tbody>
              </table>
            `;
            resultDiv.innerHTML = tableHTML;
        } else {
            resultDiv.textContent = "Tidak ada baris yang cocok dengan daftar kode tetap.";
        }
    }

    /* ===================== PAGE 3 (RISET) ===================== */
    function updateRisetCount(inputId, totalId){
      const text = document.getElementById(inputId).value.trim();
      if(!text){
        document.getElementById(totalId).textContent = "Total String: 0";
        return;
      }
      const splitted = text.split('*').filter(s => /^\d{4}$/.test(s.trim()));
      document.getElementById(totalId).textContent = `Total String: ${splitted.length}`;
    }
    function combineRisetData(){
      const box1 = document.getElementById('risetInput1').value.trim();
      const box2 = document.getElementById('risetInput2').value.trim();
      const box3 = document.getElementById('risetInput3').value.trim();
      const box4 = document.getElementById('risetInput4').value.trim();

      let arr1 = box1 ? box1.split('*').filter(s => /^\d{4}$/.test(s.trim())) : [];
      let arr2 = box2 ? box2.split('*').filter(s => /^\d{4}$/.test(s.trim())) : [];
      let arr3 = box3 ? box3.split('*').filter(s => /^\d{4}$/.test(s.trim())) : [];
      let arr4 = box4 ? box4.split('*').filter(s => /^\d{4}$/.test(s.trim())) : [];

      let merged = [...arr1, ...arr2, ...arr3, ...arr4];
      let unique = new Set(merged);
      let finalArr = [...unique];
      finalArr = shuffleArray(finalArr);

      let finalStr = finalArr.join('*');
      document.getElementById('risetCombinedResult').value = finalStr;
      document.getElementById('risetCombinedCount').textContent = 
        `Total Gabungan: ${finalArr.length}`;
    }
    function copyRisetResult(){
      const resultArea = document.getElementById('risetCombinedResult');
      if(!resultArea.value){
        alert("Belum ada data untuk disalin.");
        return;
      }
      navigator.clipboard.writeText(resultArea.value)
        .then(()=>{ alert("Berhasil disalin!"); })
        .catch(()=>{ alert("Gagal menyalin, coba manual."); });
    }
    function updatePenguranganTotal(inputId, totalId) {
        const text = document.getElementById(inputId).value.trim();
        if (!text) {
            document.getElementById(totalId).textContent = "Total String: 0";
            return;
        }
        const splitted = text.split('*').filter(s => /^\d{4}$/.test(s.trim()));
        document.getElementById(totalId).textContent = `Total String: ${splitted.length}`;
    }
    function kurangiAngka() {
        const inputA = document.getElementById('penguranganInputA').value.trim();
        const inputB = document.getElementById('penguranganInputB').value.trim();
        
        const arrA = inputA ? inputA.split('*').map(num => num.trim()).filter(num => /^\d{4}$/.test(num)) : [];
        const arrB = inputB ? inputB.split('*').map(num => num.trim()).filter(num => /^\d{4}$/.test(num)) : [];
        
        const setB = new Set(arrB);
        const hasil = arrA.filter(num => !setB.has(num));
        const shuffledHasil = shuffleArray(hasil);
        
        document.getElementById('penguranganResult').value = shuffledHasil.join('*');
        document.getElementById('penguranganCount').textContent = `Total String: ${shuffledHasil.length}`;
    }
    function copyPenguranganResult() {
        const resultArea = document.getElementById('penguranganResult');
        if (!resultArea.value) {
            alert("Belum ada data untuk disalin.");
            return;
        }
        navigator.clipboard.writeText(resultArea.value)
            .then(() => { alert("Berhasil disalin!"); })
            .catch(() => { alert("Gagal menyalin, coba manual."); });
    }

    /* Onload */
    window.onload = function(){
      generatePriorityInputsMagic(); /* Default 6 box pada SigarByTrbb */
    }
  </script>
</body>
</html>
